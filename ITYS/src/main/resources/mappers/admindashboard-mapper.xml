<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admindashboardMapper">

	<resultMap type="Payment" id="resultPayment">
		<id column="pay_no" property="pay_no" />
		<result column="student_name" property="student_name" />
		<result column="tutor_name" property="tutor_name" />
		<result column="pay_datetm" property="pay_datetm" />
		<result column="pay_method" property="pay_method" />
		<result column="pay_amount" property="pay_amount" />
		<result column="pay_status" property="pay_status" />
	</resultMap>

	<select id="todayEarning" resultType="_int">
		select nvl(sum(to_number(replace(str,'만원','0000'))),0)
		from (select pay_amount as str from payment where to_char(pay_datetm,'yymmdd')='210805')
	</select>
	
	<select id="monthSales" resultType="_int">
		select count(*) from payment WHERE TO_CHAR(PAY_DATETM,'YYMM')='2108'
	</select>
	
	<select id="totalUsers" resultType="_int">
		select count(*) from user_info 
	</select>
	
	<select id="cntChattingroom" resultType="_int">
		select count(*) from chatting_room
	</select>
	
	<select id="potential" resultType="_int">
		select count(*) from payment where pay_status='WAITING'
	</select>
	
	<select id="yearSalesByMonth" resultType="_int">
		SELECT MONTH,SUM(TO_NUMBER(REPLACE(STR,'만원','0000'))) 
		FROM (SELECT PAY_AMOUNT AS STR,TO_CHAR(PAY_DATETM,'YYMM') AS MONTH 
			  FROM PAYMENT 
			  WHERE TO_CHAR(PAY_DATETM,'YY')='21')
		GROUP BY MONTH
	</select>
	
	<select id="fiveRecentPayments" resultType="resultPayment">
		select student_name, tutor_name, pay_datetm, pay_method, pay_amount, pay_status
		from (select student_name, tutor_name, pay_datetm, pay_method, pay_amount, pay_status, rank() over (order by pay_datetm desc) as new_5_pay 
      		  from payment
     		  order by pay_datetm desc) 
		where rownum<=5
	</select>
	
</mapper>